;(function($) {
    let thewidth = 0,
        addwidth = 0,
        selTimeStageWidth = 0,
        BarMove = false,
        selTimeStage = 24*60/30,
        width = 0,
        $timeID,
        $timeStr = '',
        $selProgressBar = $('#selProgressBar');

    jQuery.playBar = {
        /* 初始化 */
        addBar: function(DOM) {
            let startTime = `<div class='BarControl'><div class='BarBeginTime'>30分钟</div></div>`,
                endTime = `<div class="TheBar"><div class="TimeBall"></div><div class="TheColorBar"></div>`+
                `</div><div class="BarFinishTime" style="margin-left: 15px;">24小时</div>`;
            DOM.append(startTime);
            $(".BarControl").append(endTime);

            width = $('.TheBar').width();
            selTimeStageWidth = width/selTimeStage;
            let b = selTimeStageWidth-1+'px';
            $('.TheColorBar').css('width', b);
            $('.TimeBall').css('left', b);
        },
        /* 点击改变 select */
        selChange : function(t){
            "use strict";
            if(!BarMove){
                let $t = $(t),
                    $val = $t.val(),
                    $h = $val.replace(/分钟/, '').split('小时');
                if($h[1]) {
                    thewidth = ($h[0]*2+1)*selTimeStageWidth;
                }else{
                    if($h[0]==30){thewidth = selTimeStageWidth;}else{thewidth = ($h[0]*2)*selTimeStageWidth;}
                }
                $('.TheColorBar').css("width", thewidth);
                $('.TimeBall').css("left", thewidth);
            }
        }
    };

    $(document).on("mousedown", '.TimeBall', function(event) {
        lastX = event.clientX;
        event.preventDefault();
        down = true;
        BarMove = true;
    });
    $(document).mousemove(function(event) {
        event.preventDefault();
        NewX = event.clientX;
        if (BarMove) {
            let mcs = NewX - lastX;
            lastX = NewX;
            if (mcs < 0) {
                if (thewidth - (-mcs) > selTimeStageWidth-2) {thewidth = thewidth - (-mcs);}
            }else{
                if (thewidth + mcs < width) {thewidth = thewidth + mcs;}else{thewidth = width;}
            }
            if(thewidth<selTimeStageWidth-2){return false;}
            $('.TheColorBar').css("width", thewidth);
            $('.TimeBall').css("left", thewidth);
            setTime(thewidth);                              // 设计时间
        }
    });
    $(document).mouseup(function() {
        if (BarMove) {
            BarMove = false;
            down = false;
            NewX = 0;
        }
    });

    /* 设置时间 */
    function setTime(w){
        "use strict";
        let $hunPercent = Math.ceil(w/selTimeStageWidth)/2*60;
        if($hunPercent==30){
            $timeStr = '30分钟';
        }else if($hunPercent%60>0){
            $timeStr = Math.floor($hunPercent/60)+'小时30分钟';
        }else{
            $timeStr = $hunPercent/60+'小时';
        }
        $selProgressBar.val($timeStr);
    }


})(jQuery);